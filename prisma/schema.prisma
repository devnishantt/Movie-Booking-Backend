generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRoles {
  USER
  ADMIN
}

enum MovieStatus {
  COMING_SOON
  NOW_SHOWING
  ENDED
}

enum SeatType {
  STANDARD
  PREMIUM
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

model User {
  id           String    @unique @default(uuid())
  email        String    @unique
  password     String    @map("hashed_password")
  firstName    String
  lastName     String?
  phone        String?
  role         UserRoles @default(USER)
  isActive     Boolean   @default(true)
  lastLogin    DateTime  @default(now())
  refreshToken String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  bookings     Booking[]

  @@index([email])
  @@index([role])
  @@map("users")
}

model Movie {
  id          String      @id @default(uuid())
  title       String
  description String      @db.Text
  duration    Int
  language    String
  director    String
  genre       String
  releaseDate DateTime
  posterUrl   String?
  trailerUrl  String?
  status      MovieStatus @default(COMING_SOON)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  Show        Show[]

  @@index([status])
  @@index([genre])
  @@map("movies")
}

model Theatre {
  id         String   @id @default(uuid())
  name       String
  location   String
  city       String
  totalSeats Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  seats      Seat[]
  show       Show[]

  @@index([city])
  @@map("theatres")
}

model Seat {
  id           String        @id @default(uuid())
  theatreId    String
  theatre      Theatre       @relation(fields: [theatreId], references: [id], onDelete: Cascade)
  row          String
  seatNumber   Int
  seatType     SeatType      @default(STANDARD)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  bookingSeats BookingSeat[]

  @@unique([theatreId, row, seatNumber])
  @@index([theatreId])
  @@map("seats")
}

model Show {
  id             String    @id @default(uuid())
  movieId        String
  movie          Movie     @relation(fields: [movieId], references: [id], onDelete: Cascade)
  theatreId      String
  theatre        Theatre   @relation(fields: [theatreId], references: [id], onDelete: Cascade)
  showTime       DateTime
  price          Float
  availableSeats Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  bookings       Booking[]

  @@index([movieId])
  @@index([theatreId])
  @@index([showTime])
  @@map("shows")
}

model Booking {
  id           String        @id @default(uuid())
  userId       String
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  showId       String
  show         Show          @relation(fields: [showId], references: [id], onDelete: Cascade)
  totalAmount  Float
  status       BookingStatus @default(PENDING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  bookingSeats BookingSeat[]

  @@index([userId])
  @@index([showId])
  @@index([status])
  @@map("bookings")
}

model BookingSeat {
  id        String   @id @default(uuid())
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  seatId    String
  seat      Seat     @relation(fields: [seatId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([bookingId, seatId])
  @@index([seatId])
  @@map("bookingSeats")
}
